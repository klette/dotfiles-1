#!/bin/bash

function setupTmux() {
  if [[ $(tmux list-sessions 2>/dev/null | awk "/^$1:/ { print 1 }") == 1 ]]; then
    tmux -2 attach-session -t $1
  else
    tmux list-sessions 2>/dev/null
    echo
    read -p "Couldn't find the $1 session in the list above. Do you want to create it? (y/n) " -n 1
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      createSession $1
    fi
  fi
}

function createSession () {
  case $1 in
    dev )
      tmux new-session -d -s $1 'ssh -t tlk screen -rd'
      tmux rename-window 'irssi'

      tmux new-window -t $1:2 -n 'mutt' 'mutt'
      tmux new-window -t $1:3 -n 'vim' '/bin/bash -c "[[ -e ~/.vim_session ]] && vim -S ~/.vim_session"' \; split-window -v -l 5 'sudo tail -f /var/log/apache2/error.log'
      tmux new-window -t $1:4 -n 'bash' '/bin/bash'

      tmux select-window -t $1:3
      tmux -2 attach-session -t $1
      ;;
    cindy )
      tmux new-session -d -s $1 'ssh -t tlk screen -rd'
      tmux rename-window 'irssi'

      tmux new-window -t $1:2 -n 'mutt' 'mutt'
      tmux new-window -t $1:3 -n 'bash' '/bin/bash'

      tmux select-window -t $1:2
      tmux -2 attach-session -t $1
      ;;
    * )
      echo "No premade session exists for $1"
      ;;
  esac
}

case $(hostname) in
  minas-tirith )
    setupTmux "dev"
    ;;
  cindy )
    setupTmux "cindy"
    ;;
  genero )
    ssh minastirith
    ;;
esac

